type Contract @entity(immutable: false) {
  id: ID!                           # contract address + chainID
  address: Bytes!
  chainID: String!
  name: String!                     # from ERC7730 metadata
  version: String!                  # from ERC7730 metadata  
  description: String
  hasApprovedMetadata: Boolean!
  
  # Latest spec tracking for disputes/replacements
  latestApprovedSpecID: String!     # ID of most recent approved spec
  latestSpecTimestamp: BigInt!      # timestamp of latest spec
  
  functionCount: Int!
  functions: [Function!]! @derivedFrom(field: "contract")
  createdAt: BigInt!
  updatedAt: BigInt!
}

type Function @entity(immutable: false) {
  id: ID!                    # contract-chainID-selector
  contract: Contract!
  selector: String!          # 0xa9059cbb
  chainID: String!
  name: String!              # "transfer"
  intent: String!            # "Transfer {{amount}} to {{to}}"
  displayFormat: String!     # "transfer" 
  parameterTypes: [String!]! # ["address", "uint256"]
  createdAt: BigInt!
}

type Spec @entity(immutable: false) {
  id: Bytes!
  targetContract: Bytes!            # contract this spec is for
  user: Bytes!                      # creator address
  ipfs: String!                     # IPFS CID
  questionId: Bytes                 # RealityETH question ID
  chainID: String                   # from event
  status: SpecStatus!
  blockTimestamp: BigInt!
  proposedTimestamp: BigInt
  isFinalized: Boolean
  isAccepted: Boolean
  eventTimestamp: BigInt            # timestamp from event
  incentiveId: Bytes                # incentive ID from event
}

enum SpecStatus {
  COMMITTED
  SUBMITTED
  PROPOSED  
  FINALIZED
  CANCELLED
}

# Removed LogAssertSpecInvalid and LogAssertSpecValid as they are obsolete in the new contract

type LogCreateSpec @entity(immutable: true) {
  id: Bytes!
  creator: Bytes! # address (was 'user')
  specID: Bytes! # bytes32
  ipfs: String! # string
  targetContract: Bytes! # address (new field)
  chainId: BigInt! # uint256 (new field)
  timestamp: BigInt! # uint256 (new field)
  incentiveId: Bytes! # bytes32 (new field)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogHandleResult @entity(immutable: true) {
  id: Bytes!
  specID: Bytes! # bytes32
  isAccepted: Boolean! # bool
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogProposeSpec @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  specID: Bytes! # bytes32
  questionId: Bytes! # bytes32
  bond: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogCommitSpec @entity(immutable: true) {
  id: Bytes!
  committer: Bytes! # address
  commitmentId: Bytes! # bytes32
  targetContract: Bytes! # address
  chainId: BigInt! # uint256
  bondAmount: BigInt! # uint256
  revealDeadline: BigInt! # uint64
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogRevealSpec @entity(immutable: true) {
  id: Bytes!
  creator: Bytes! # address
  specID: Bytes! # bytes32
  commitmentId: Bytes! # bytes32
  ipfs: String! # string
  targetContract: Bytes! # address
  chainId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogIncentiveCreated @entity(immutable: true) {
  id: Bytes!
  incentiveId: Bytes! # bytes32
  creator: Bytes! # address
  targetContract: Bytes! # address
  chainId: BigInt! # uint256
  token: Bytes! # address
  amount: BigInt! # uint256
  deadline: BigInt! # uint64
  description: String! # string
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogIncentiveClaimed @entity(immutable: true) {
  id: Bytes!
  incentiveId: Bytes! # bytes32
  claimer: Bytes! # address
  specID: Bytes! # bytes32
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogIncentiveClawback @entity(immutable: true) {
  id: Bytes!
  incentiveId: Bytes! # bytes32
  creator: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogContractSpecAdded @entity(immutable: true) {
  id: Bytes!
  targetContract: Bytes! # address
  specID: Bytes! # bytes32
  creator: Bytes! # address
  chainId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogEmergencyPause @entity(immutable: true) {
  id: Bytes!
  admin: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LogEmergencyUnpause @entity(immutable: true) {
  id: Bytes!
  admin: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
